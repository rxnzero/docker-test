<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
	
<sqlMap namespace="BapKikwan">

	<statement id="selectList" resultClass="java.util.HashMap">
		SELECT
	       ROWNO AS "ROWNO" , 
	       KikwanCd AS "KIKWANCD" ,  
	       KikwanName AS "KIKWANNAME"       , 
	       SysIp AS "SYSIP" ,  
	       EncIp AS "ENCIP" ,  
	       ThisMsgUseYn AS "THISMSGUSEYN",
	       ThisMsgRegsntID AS "THISMSGREGSNTID"  ,  
	       ThisMsgRegiHMS AS "THISMSGREGIHMS"  ,  
	       ThisMsgAmndrID AS "THISMSGAMNDRID"   ,
	       ThisMsgAmndHMS AS "THISMSGAMNDHMS"  
	  	FROM (
		    SELECT
		       ROW_NUMBER() OVER( ORDER BY KikwanCd) ROWNO, 
		       KikwanCd         ,  
		       KikwanName       , 
		       SysIp            ,  
		       EncIp            ,  
		       ThisMsgUseYn     ,
		       ThisMsgRegsntID  ,  
		       ThisMsgRegiHMS   ,  
		       ThisMsgAmndrID   ,
		       ThisMsgAmndHMS  
		      FROM $schemaId$.TSEAIBJ21
		    <dynamic prepend="WHERE">
			    <isNotEmpty prepend="AND" property="searchKikwanCd">
					UPPER(KikwanCd) LIKE '%' || UPPER(#searchKikwanCd#) || '%'
				</isNotEmpty>
			    <isNotEmpty prepend="AND" property="searchKikwanName">
					KikwanName LIKE '%' || #searchKikwanName# || '%'
				</isNotEmpty> 
			</dynamic> 
	       ) TMP
	 	WHERE ROWNO BETWEEN #startNum# AND #endNum#
	</statement>	

	<statement id="selectListCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT 	COUNT(*) AS "TOTALCOUNT"
		FROM $schemaId$.TSEAIBJ21
	    <dynamic prepend="WHERE">
		    <isNotEmpty prepend="AND" property="searchKikwanCd">
				KikwanCd LIKE '%' || #searchKikwanCd# || '%' 
			</isNotEmpty>
		    <isNotEmpty prepend="AND" property="searchKikwanName">
				KikwanName LIKE '%' || #searchKikwanName# || '%' 
			</isNotEmpty> 
		</dynamic> 			
	</statement>	
	
	<statement id="selectDetail" resultClass="java.util.HashMap">
		SELECT 	
	       KikwanCd AS "KIKWANCD" ,  
	       KikwanName AS "KIKWANNAME"       , 
	       SysIp AS "SYSIP" ,  
	       EncIp AS "ENCIP" ,  
	       ThisMsgUseYn AS "THISMSGUSEYN",
	       ThisMsgRegsntID AS "THISMSGREGSNTID"  ,  
	       ThisMsgRegiHMS AS "THISMSGREGIHMS"  ,  
	       ThisMsgAmndrID AS "THISMSGAMNDRID"   ,
	       ThisMsgAmndHMS AS "THISMSGAMNDHMS"  
        FROM $schemaId$.TSEAIBJ21
	    WHERE TRIM(KikwanCd) = TRIM(#kikwanCd#)
	</statement>  
	<statement id="update" resultClass="java.lang.Integer">
		UPDATE $schemaId$.TSEAIBJ21 
		SET
			 KikwanName = #kikwanName#,
			 SysIp = #SysIp#,
			 EncIP = #EncIp#,
			 ThisMsgUseYn = #thisMsgUseYn#,
			 ThisMsgAmndrID = #userid#,
			 ThisMsgAmndHMS = TO_CHAR(LOCALTIMESTAMP,'YYYYMMDDHH24MISSMS')
		WHERE KikwanCd = #kikwanCd#
	</statement>
	
	<statement id="insert" resultClass="java.lang.Integer">
		INSERT INTO $schemaId$.TSEAIBJ21 (
	       KikwanCd         ,  
	       KikwanName       , 
	       SysIp            ,  
	       EncIp            ,  
	       ThisMsgUseYn     ,
	       ThisMsgRegsntID  ,  
	       ThisMsgRegiHMS   ,  
	       ThisMsgAmndrID   ,
	       ThisMsgAmndHMS    )
		VALUES (
			#kikwanCd# ,
			#kikwanName# ,
			#SysIp#,
			#EncIp#,
			#thisMsgUseYn# ,
			#userid# ,
			TO_CHAR(LOCALTIMESTAMP,'YYYYMMDDHH24MISSMS'),
			#userid# ,
			TO_CHAR(LOCALTIMESTAMP,'YYYYMMDDHH24MISSMS') 
		)
	</statement>
	

	<statement id="delete" resultClass="java.lang.Integer">
		DELETE 	FROM $schemaId$.TSEAIBJ21 
        WHERE KikwanCd = #kikwanCd#
	</statement>

     <statement id="selectAutoCd" resultClass="java.util.HashMap">
		SELECT 	
         REPLACE(CONCAT('KJB',TO_CHAR(TO_NUMBER(substr(COALESCE(MAX(KikwanCd),'0000'),4))+1,'0999999')),' ','') AS "AUTOCD"                 
        FROM $schemaId$.TSEAIBJ21
        WHERE KikwanCd LIKE 'KJB%'
	
    </statement>   
 
</sqlMap>