<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BatSchedule">

	<statement id="selectList" resultClass="java.util.HashMap">
		SELECT *
		FROM ( 
			SELECT @NO := @NO + 1 AS ROWNO,   
		              SUBSTR(A.BJOBMSGSCHEID, 3,3 ) AS WORKGRPCD,
		              A.BJOBMSGSCHEID,
		              A.BATCHTYPE,
	                  A.SNDRCVSTARTHMS,
	                  A.SNDRCVENDHMS,
	                  A.DAYCYCLETIME,
	                  A.SCHEKIND,
	                  A.THISMSGUSEYN,
	                  A.THISMSGSCHEDESC,
	                  A.THISMSGREGSNTID,
	                  SUBSTR(A.THISMSGREGIHMS,1,14) AS THISMSGREGIHMS,
	                  A.THISMSGAMNDRID,
	                  SUBSTR(A.THISMSGAMNDHMS,1,14) AS THISMSGAMNDHMS
	           FROM   $schemaId$.TSEAIES07 A,  (SELECT @NO := 0) R
	           WHERE  SUBSTR(A.BjobMsgScheID, 3,3 ) IN (SELECT EAIBzwkDstcd FROM $schemaId$.TSEAIRM06 WHERE userID = #loginEmpno# )
	           <isNotEmpty prepend="AND" property="searchEaiBzwkDstcd">
                      SUBSTR(A.BjobMsgScheID, 3,3 ) = #searchEaiBzwkDstcd# 
               </isNotEmpty>
               <isNotEmpty prepend="AND" property="searchBatchType">
         			  A.batchType = #searchBatchType#
               </isNotEmpty>
               <isNotEmpty prepend="AND" property="searchThisMsgScheDesc">
                      A.ThisMsgScheDesc LIKE CONCAT( '%' , #searchThisMsgScheDesc# , '%' )
               </isNotEmpty>
	           ORDER BY BJOBMSGSCHEID
			 ) ORGTABLE
		WHERE ROWNO BETWEEN #startNum# AND #endNum#
	</statement>	

	<statement id="selectListCount" resultClass="java.lang.Integer">
		SELECT 	COUNT(A.BjobMsgScheID) AS TOTALCOUNT
		FROM    $schemaId$.TSEAIES07 A
	    WHERE  SUBSTR(A.BjobMsgScheID, 3,3 ) IN (SELECT EAIBzwkDstcd FROM $schemaId$.TSEAIRM06 WHERE userID = #loginEmpno# )
	    <isNotEmpty prepend="AND" property="searchEaiBzwkDstcd">
               SUBSTR(A.BjobMsgScheID, 3,3 ) = #searchEaiBzwkDstcd# 
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="searchBatchType">
         		A.batchType = #searchBatchType#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="searchThisMsgScheDesc">
                A.ThisMsgScheDesc LIKE CONCAT( '%' , #searchThisMsgScheDesc# , '%' )
        </isNotEmpty>
	</statement>	
	
	<statement id="selectScheID" resultClass="java.lang.String">
		SELECT CONCAT( #bjobMsgScheID# , 
			LPAD( CAST( IFNULL( MAX( CAST( SUBSTR(BjobMsgScheID,14,3) AS UNSIGNED) ) ,0 )+1 AS CHAR),3,'0') 
		)  AS BJOBMSGSCHEID
		FROM   $schemaId$.TSEAIES07
 		WHERE  SUBSTR(BjobMsgScheID,1,13)= #bjobMsgScheID#
	</statement>

	<statement id="insert" resultClass="java.lang.Integer">
		INSERT 	INTO $schemaId$.TSEAIES07(		
				    BjobMsgScheID     ,
				    BatchType         ,				
				    ThisMsgScheDesc   ,	
				    SndrcvStartHMS    ,
				    SndrcvEndHMS      ,
				    DayCycleTime      ,
				    ScheKind          ,
				    ThisMsgUseYn      ,
				    ThisMsgRegsntID   ,
				    ThisMsgRegiHMS    ,
				    ThisMsgAmndrID    ,
				    ThisMsgAmndHMS     )
		VALUES	(   #bjobMsgScheID#   ,
		            #batchType#       , 
			 	    #thisMsgScheDesc# ,
				    #sndrcvStartHMS#  ,
			 	    #sndrcvEndHMS#    ,
			 	    #dayCycleTime#    ,
			 	    #scheKind#        ,
			 	    #thisMsgUseYn#    ,
			 	    #userid#          ,
			 	    SUBSTR( DATE_FORMAT( NOW(2), '%Y%m%d%H%i%s%f'), 1, 16 ) , 
			 	    #userid#          ,
			 	    SUBSTR( DATE_FORMAT( NOW(2), '%Y%m%d%H%i%s%f'), 1, 16 )
				)
	</statement>
	
	<statement id="update" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		UPDATE  $schemaId$.TSEAIES07 SET
				ThisMsgScheDesc = #thisMsgScheDesc#,
				SndrcvStartHMS  = #sndrcvStartHMS# ,
				SndrcvEndHMS    = #sndrcvEndHMS#   ,
				DayCycleTime    = #dayCycleTime#   ,
				ThisMsgUseYn    = #thisMsgUseYn#   ,
				ThisMsgAmndrID  = #userid# ,
				ThisMsgAmndHMS  = SUBSTR( DATE_FORMAT( NOW(2), '%Y%m%d%H%i%s%f'), 1, 16 )
		WHERE   BjobMsgScheID   = #bjobMsgScheID#

	</statement>

	<statement id="insertInterface" resultClass="java.lang.Integer">
		INSERT 	INTO $schemaId$.TSEAIES09(		
					BjobMsgScheID,
					IntfId,
					RegId,
					RegDate
				)
		VALUES	(
		         #bjobMsgScheID#,
		         #intfId#,
		         #userid#,
		         SUBSTR( DATE_FORMAT( NOW(2), '%Y%m%d%H%i%s%f'), 1, 16 )
				)
	</statement>

</sqlMap>
