<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
	
<sqlMap namespace="BapMessageProc">

	<statement id="selectList" resultClass="java.util.HashMap">
        SELECT BJOBMSGDSTCD            ,
               BJOBBZWKDSTCD           ,
               BJOBBZWKNAME            ,
               BJOBMSGDSTICNAME        ,
               BJOBTRANDSTCDNAME       ,
               EAIFILESENDUSEYN        ,
               EAIFILERECVUSEYN        ,
               THISMSGUSEYN            ,
               UAPPLCD                 ,
               GROUPCOCD               ,
               BJOBTELGMRECSIZE        ,
               SNDRCVFILENAME          ,
               THISMSGCHRGIDS          ,
                ROWNO
        FROM ( SELECT @NO := @NO + 1 AS ROWNO,
                      A.BjobMsgDstcd,
                      A.BjobBzwkDstcd,
                      B.BjobBzwkName,
                      A.BjobMsgDsticName,
                      A.BjobTranDstcdName,
                      A.BjobTelgmRecSize,
                      A.EAIFileSendUseYn,
                      A.EAIFileRecvUseYn,
                      A.SndrcvFileName,
                      A.ThisMsgUseYn,
                      A.ThisMsgChrgIDs,	
                      A.UapplCd,	
                      A.GroupCoCd	
               FROM   $schemaId$.TSEAIBJ01 A, $schemaId$.TSEAIBJ02 B,  (SELECT @NO := 0) R
               WHERE  A.BjobBzwkDstcd = B.BjobBzwkDstcd
               AND    B.BjobBzwkName Like #likeBjobBzwkName#
               AND    A.BjobMsgDsticName Like #likeBjobMsgDsticName#
               AND    A.BjobTranDstcdName Like #likeBjobTranDstcdName#
               AND    A.UapplCd Like #likeUapplCd#
               AND    A.ThisMsgChrgIDs LIKE #likeThisMsgChrgIDs#
               ORDER BY BjobTranDstcdName, BjobMsgDstcd
			<isNotEmpty prepend="AND" property="groupCoCd" >
                      A.GroupCoCd = #searchGroupCoCd#
			</isNotEmpty>
	         ) TMP
	 	WHERE ROWNO BETWEEN #startNum# AND #endNum#
	</statement>	

    <statement id="generatePK" resultClass="java.lang.String">
        SELECT 
        COALESCE( 
			CONCAT( MAX(SUBSTR(BjobMsgDstcd, 1,5)) , SUBSTR( CAST( CAST( MAX( SUBSTR(BjobMsgDstcd, 6) ) AS UNSIGNED) + 100001 AS CHAR),2) ) , 
			CONCAT( #bjobBzwkDstcd# , 	'00001')
		)
        FROM   $schemaId$.TSEAIBJ01
        WHERE BjobBzwkDstcd = #bjobBzwkDstcd#
    </statement>

    <statement id="checkCount" resultClass="java.lang.Integer">
        SELECT COUNT(BjobMsgDstcd)
        FROM   $schemaId$.TSEAIBJ01
        WHERE BjobMsgDstcd = #bjobMsgDstcd#
        OR   ( BjobBzwkDstcd = #bjobBzwkDstcd# AND BjobTranDstcdName = #bjobTranDstcdName# )
    </statement>
    
	<statement id="getBzwkDstcd" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
         SELECT BJOBBZWKDSTCD, BJOBBZWKNAME
         FROM $schemaId$.TSEAIBJ02
         ORDER BY BjobBzwkDstcd
	</statement>
	
	<statement id="getProps" resultClass="java.util.HashMap">
        SELECT IFNULL(A.PRPTYNAME, B.PRPTYNAME) AS PRPTYNAME,
               A.PRPTYDESC AS PRPTYDESC,
               B.PRPTY2VAL AS PRPTY2VAL
        FROM ( SELECT PrptyName,
                      PrptyDesc
               FROM $schemaId$.TSEAIBP06
               WHERE  BjobBzwkDstcd = #bjobBzwkDstcd#
               AND    PrptyTypDstcd = 'F' ) A
             LEFT JOIN
             ( SELECT PrptyName,
                      Prpty2Val
               FROM   $schemaId$.TSEAIBP02
               WHERE  PrptyGroupName = #propGroupName# ) B
             ON A.PrptyName = B.PrptyName
        UNION ALL
        SELECT IFNULL(A.PRPTYNAME, B.PRPTYNAME) AS PRPTYNAME,
               A.PRPTYDESC AS PRPTYDESC,
               B.PRPTY2VAL AS PRPTY2VAL
        FROM ( SELECT PrptyName,
                      PrptyDesc
               FROM $schemaId$.TSEAIBP06
               WHERE  BjobBzwkDstcd = #bjobBzwkDstcd#
               AND    PrptyTypDstcd = 'F' ) A
             RIGHT JOIN
             ( SELECT PrptyName,
                      Prpty2Val
               FROM   $schemaId$.TSEAIBP02
               WHERE  PrptyGroupName = #propGroupName# ) B
             ON A.PrptyName = B.PrptyName
             WHERE A.PrptyName IS NULL 
	</statement>	
		
	<statement id="insert" resultClass="java.lang.Integer">
		INSERT INTO $schemaId$.TSEAIBJ01 (
		    BjobMsgDstcd              ,
		    BjobMsgDsticName          ,
		    BjobBzwkDstcd             ,
		    BjobTranDstcdName         ,
            BjobTelgmHdrSize          ,
            BjobTelgmTrailSize        ,
            EAIFileSendUseYn          ,
            EAIFileRecvUseYn          ,
            RecvNotiUseYn             ,
            ThisMsgUseYn              ,
            ThisMsgRegsntID           ,
            ThisMsgRegiHMS            ,
            ThisMsgAmndrID            ,
            ThisMsgAmndHMS            ,
            MsgPrcssPrity             ,
            BjobTelgmRecSize          ,
            SysCd                     ,
            UapplCd                   ,
            SndrcvFileName            ,
            ThisMsgChrgIDs            ,
            GroupCoCd                 ,
            intfID                    )
		VALUES (
		    #bjobMsgDstcd#              ,
		    #bjobMsgDsticName#          ,
		    #bjobBzwkDstcd#             ,
		    #bjobTranDstcdName#         ,
            #bjobTelgmHdrSize#          ,
            #bjobTelgmTrailSize#        ,
            #fileSendUseYn#             ,
            #fileRecvUseYn#             ,
            #recvNotiUseYn#             ,
            #thisMsgUseYn#              ,
            #userid#           ,
            SUBSTR( DATE_FORMAT( NOW(2), '%Y%m%d%H%i%s%f'), 1, 16 ),
            #userid#            ,
            SUBSTR( DATE_FORMAT( NOW(2), '%Y%m%d%H%i%s%f'), 1, 16 ),
            #msgPrcssPrity#             ,
            #bjobTelgmRecSize#          ,
            #sysCd#                     ,
            #uapplCd#                   ,
            #sndrcvFileName#            ,
            #thisMsgChrgIDs#            ,
            #groupCoCd#                 ,
            #intfID#                    )
	</statement>

	<statement id="update" resultClass="java.lang.Integer">
		UPDATE $schemaId$.TSEAIBJ01
		SET BjobMsgDsticName          =  #bjobMsgDsticName#          ,
		    BjobBzwkDstcd             =  #bjobBzwkDstcd#             ,
		    BjobTranDstcdName         =  #bjobTranDstcdName#         ,
            BjobTelgmHdrSize          =  #bjobTelgmHdrSize#          ,
            BjobTelgmTrailSize        =  #bjobTelgmTrailSize#        ,
            EAIFileSendUseYn          =  #fileSendUseYn#             ,
            EAIFileRecvUseYn          =  #fileRecvUseYn#             ,
            RecvNotiUseYn             =  #recvNotiUseYn#             ,
            ThisMsgUseYn              =  #thisMsgUseYn#              ,
            ThisMsgAmndrID            =  #userid#            ,
            ThisMsgAmndHMS            =  SUBSTR( DATE_FORMAT( NOW(2), '%Y%m%d%H%i%s%f'), 1, 16 ),
            MsgPrcssPrity             =  #msgPrcssPrity#             ,
            BjobTelgmRecSize          =  #bjobTelgmRecSize#          ,
            SysCd                     =  #sysCd#                     ,
            UapplCd                   =  #uapplCd#                   ,
            SndrcvFileName            =  #sndrcvFileName#            ,
            ThisMsgChrgIDs            =  #thisMsgChrgIDs#            ,
            GroupCoCd                 =  #groupCoCd#                 ,
            intfID                    =  #intfID#                   
		WHERE BjobMsgDstcd = #bjobMsgDstcd#
		
	</statement>

	<statement id="userCount" resultClass="java.lang.Integer">
        SELECT COUNT(*) AS "TotalCount"
        FROM   $schemaId$.TSEAIRM02
		<dynamic prepend="WHERE">
		    <isNotEmpty prepend="AND" property="pafiarInfoEmpid" >
                 PafiarInfoEmpid LIKE CONCAT( #pafiarInfoEmpid#  ,  '%') 
		    </isNotEmpty>
		    <isNotEmpty prepend="AND" property="userName" >
                 UserName LIKE CONCAT(  #userName# , '%')
		    </isNotEmpty>
		</dynamic> 
	</statement>	

	<statement id="getUserList" resultClass="java.util.HashMap">
        SELECT PAFIARINFOEMPID,
               USERNAME
        FROM   ( SELECT @NO := @NO + 1 AS ROWNO,
                        PafiarInfoEmpid,
                        UserName
                 FROM   $schemaId$.TSEAIRM02,  (SELECT @NO := 0) R
				<dynamic prepend="WHERE">
				    <isNotEmpty prepend="AND" property="pafiarInfoEmpid" >
		                 PafiarInfoEmpid LIKE CONCAT( #pafiarInfoEmpid#  ,  '%') 
				    </isNotEmpty>
				    <isNotEmpty prepend="AND" property="userName" >
		                 UserName LIKE CONCAT(  #userName# , '%')
				    </isNotEmpty>
				</dynamic>
				ORDER BY PafiarInfoEmpid 
	           ) TMP
	 	WHERE ROWNO BETWEEN #startNum# AND #endNum#
	</statement>	

	<statement id="getUserList2" resultClass="java.util.HashMap">
        SELECT PAFIARINFOEMPID,
               USERNAME
        FROM   $schemaId$.TSEAIRM02
        WHERE  PafiarInfoEmpid IN (
                                <iterate property="chrgIDs" conjunction=", ">
                                    #chrgIDs[]#
                                </iterate>
                                    )
	</statement>	

	<statement id="getUserList3" resultClass="java.util.HashMap">
        SELECT PAFIARINFOEMPID,
               USERNAME
        FROM   $schemaId$.TSEAIRM02
	</statement>	

</sqlMap>