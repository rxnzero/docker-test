<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BatInterface">

	<statement id="selectList" resultClass="java.util.HashMap">
		SELECT 
			ROWNO         AS "ROWNO" ,
			BzwkDsticName AS "BZWKDSTICNAME" , 
			batchType     AS "BATCHTYPE" ,
			intfId        AS "INTFID" ,
			intfName      AS "INTFNAME" ,
			intfDesc      AS "INTFDESC" ,
			sndAdptrCd    AS "SNDADPTRCD" ,
			sndAdptrCdSeq AS "SNDADPTRCDSEQ" ,
			sndAdptrCdStr AS "SNDADPTRCDSTR" ,
			intfStartDate AS "INTFSTARTDATE" ,
			intfEndDate   AS "INTFENDDATE" ,
			delYn         AS "DELYN" ,
			eventCallVal  AS "EVENTCALLVAL"  
		FROM (
                SELECT  ROW_NUMBER() OVER(ORDER BY batchType,intfId) ROWNO,
                        B.BzwkDsticName, 
                        A.batchType    ,
                        A.intfId       ,
                        A.intfName     ,
                        A.intfDesc     ,
                        A.sndAdptrCd   ,
                        A.sndAdptrCdSeq,
                        A.sndAdptrCd || '[' || CAST(A.sndAdptrCdSeq AS CHAR) || ']' AS sndAdptrCdStr,
                        substr(A.intfStartDate,1,8) AS intfStartDate,
                        substr(A.intfEndDate,1,8)   AS intfEndDate,
                        A.delYn      ,
                        A.eventCallVal
		 	    FROM    $schemaId$.TSEAIEA04 A,
		 	            $schemaId$.TSEAICM01 B
                WHERE   A.workGrpCd = B.EAIBzwkDstcd
                AND     A.workGrpCd IN (SELECT EAIBzwkDstcd FROM $schemaId$.TSEAIRM06 WHERE userID = #loginEmpno# )         
				<isNotEmpty prepend="AND" property="searchEaiBzwkDstcd">
					A.workGrpCd =  #searchEaiBzwkDstcd#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchDelYn">
					A.delYn =  #searchDelYn#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchBatchType">
					A.batchType = #searchBatchType#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchInterfaceNm">
				   ( A.intfName LIKE '%' || #searchInterfaceNm# || '%' OR A.intfId LIKE '%' || #searchInterfaceNm# || '%' )
				</isNotEmpty>				
				<isNotEmpty prepend="AND" property="searchFtpHostname">
				    A.intfId IN (SELECT intfId FROM $schemaId$.TSEAIEA05 WHERE ftpHostname LIKE #searchFtpHostname# )
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchRmtSevrFTPUID">
				    A.intfId IN (SELECT intfId FROM $schemaId$.TSEAIEA05 WHERE rmtSevrFTPUID LIKE #searchRmtSevrFTPUID# )
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchJndi">
				    A.intfId IN (SELECT T2.intfId FROM $schemaId$.TSEAIEA02 T1, $schemaId$.TSEAIEA03 T2 WHERE T1.jndiDatasource LIKE #searchJndi# AND T1.adptrCd=T2.adptrCd )
				</isNotEmpty>
				ORDER BY batchType,intfId

			) ORGTABLE
		WHERE ROWNO BETWEEN #startNum# AND #endNum#
	</statement>	

	<statement id="selectListCount" resultClass="java.lang.Integer">
		SELECT 	COUNT(A.intfId) AS "TOTALCOUNT"
		 	    FROM    $schemaId$.TSEAIEA04 A,
		 	            $schemaId$.TSEAICM01 B
                WHERE   A.workGrpCd = B.EAIBzwkDstcd
                AND     A.workGrpCd IN (SELECT EAIBzwkDstcd FROM $schemaId$.TSEAIRM06 WHERE userID = #loginEmpno# )         
				<isNotEmpty prepend="AND" property="searchEaiBzwkDstcd">
					A.workGrpCd =  #searchEaiBzwkDstcd#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchDelYn">
					A.delYn =  #searchDelYn#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchBatchType">
					A.batchType = #searchBatchType#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchInterfaceNm">
				   ( A.intfName LIKE '%' || #searchInterfaceNm# || '%' OR A.intfId LIKE '%' || #searchInterfaceNm# || '%' )
				</isNotEmpty>				
				<isNotEmpty prepend="AND" property="searchFtpHostname">
				    A.intfId IN (SELECT intfId FROM $schemaId$.TSEAIEA05 WHERE ftpHostname LIKE #searchFtpHostname# )
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchRmtSevrFTPUID">
				    A.intfId IN (SELECT intfId FROM $schemaId$.TSEAIEA05 WHERE rmtSevrFTPUID LIKE #searchRmtSevrFTPUID# )
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="searchJndi">
				    A.intfId IN (SELECT T2.intfId FROM $schemaId$.TSEAIEA02 T1, $schemaId$.TSEAIEA03 T2 WHERE T1.jndiDatasource LIKE #searchJndi# AND T1.adptrCd=T2.adptrCd )
				</isNotEmpty>
	</statement>	
	
	<statement id="insert" resultClass="java.lang.Integer">
		INSERT 	INTO $schemaId$.TSEAIEA04(		
				intfId,         intfName, 
				intfDesc,       workGrpCd,    Level4,  sndAdptrCd,				
				sndAdptrCdSeq,  batchType,    regDate,					
				regUserid,      modDate,      modUserid,
				intfStartDate,  intfEndDate,  delYn,
				eventCallVal,   postJobHostName,
				postJobPortNoName,  postJobUID,
				postJobUserPwdName, postJobCmd,
				sizeOnce,           procTerm,
				reqChgr,            reqChgrTlno,
				resChgr,            resChgrTlno
				)
		VALUES	(
		         #intfId#,         #intfName#, 
			 	 #intfDesc#,       #workGrpCd#,      #Level4#, #sndAdptrCd#,
				 cast (#sndAdptrCdSeq# as integer),  #batchType#,   TO_CHAR(LOCALTIMESTAMP,'YYYYMMDDHH24MISSMS') ,
			 	 #userid  #,       TO_CHAR(LOCALTIMESTAMP,'YYYYMMDDHH24MISSMS'),     #userid#,
			 	 COALESCE( #intfStartDate#, TO_CHAR(LOCALTIMESTAMP,'YYYYMMDDHH24MISSMS') ),   COALESCE(#intfEndDate#,'99991231235959'),
			 	 #delYn#,      #eventCallVal#,         #postJobHostName#,        #postJobPortNoName#,
			 	 #postJobUID#,        #postJobUserPwdName#,        #postJobCmd#,
			 	 #sizeOnce#,          #procTerm#,
				 #reqChgr#,           #reqChgrTlno#,
				 #resChgr#,           #resChgrTlno#
				)
	</statement>
	
	<statement id="update" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		UPDATE  $schemaId$.TSEAIEA04 SET
				intfName           = #intfName#,
				intfDesc           = #intfDesc#,
				Level4             = #Level4#,
				sndAdptrCd         = #sndAdptrCd#,				
				sndAdptrCdSeq      =  CAST(#sndAdptrCdSeq# AS NUMERIC),
				modDate            = TO_CHAR(LOCALTIMESTAMP,'YYYYMMDDHH24MISSMS') ,
				modUserid          = #userid#,	
				intfStartDate      = COALESCE(#intfStartDate#,intfStartDate),	
				intfEndDate        = COALESCE(#intfEndDate#,intfEndDate),
				delYn              = #delYn#,
				eventCallVal       = #eventCallVal#,
				postJobHostName    = #postJobHostName#,
                postJobPortNoName  = #postJobPortNoName#,
                postJobUID         = #postJobUID#,
                postJobUserPwdName = #postJobUserPwdName#,
                postJobCmd         = #postJobCmd#,
                sizeOnce           = #sizeOnce#,
                procTerm           = #procTerm#,
				reqChgr            = #reqChgr#,
				reqChgrTlno        = #reqChgrTlno#,
				resChgr            = #resChgr#,
				resChgrTlno        = #resChgrTlno#
		WHERE   intfId             = #intfId#

	</statement>

	<statement id="adapterList" resultClass="java.util.HashMap">
		SELECT
			ROWNO AS "ROWNO"  ,
			workGrpCd     AS "WORKGRPCD",
			BzwkDsticName AS "BZWKDSTICNAME",
			adptrCd       AS "ADPTRCD",
			adptrCdSeq    AS "ADPTRCDSEQ",
			sqlName       AS "SQLNAME",
			sqlNameDesc   AS "SQLNAMEDESC",
			adptrKind     AS "ADPTRKIND",
			sndRcvKind    AS "SNDRCVKIND",
			intfId        AS "INTFID"
		FROM (
		SELECT ROW_NUMBER() OVER(ORDER BY workGrpCd, adptrCd, adptrCdSeq) ROWNO, TBL.* FROM (
		SELECT  A.workGrpCd    ,
		 	    C.BzwkDsticName,
		 	    B.adptrCd      ,
		 	    B.adptrCdSeq   ,
		 	    B.sqlName      ,
		 	    B.sqlNameDesc  ,
		 	    A.adptrKind    ,
		 	    A.sndRcvKind   ,
		 	    B.intfId
		FROM    $schemaId$.TSEAIEA02 A,
		 	    $schemaId$.TSEAIEA03 B,
		 	    $schemaId$.TSEAICM01 C
		WHERE   A.adptrCd = B.adptrCd
		AND     A.workGrpCd = C.EAIBzwkDstcd
		AND     A.workGrpCd =  #searchEaiBzwkDstcd#
		AND     A.sndRcvKind = #searchSndRcvKind#
		AND     A.adptrKind =  #searchAdptrKind#
		<isNotEmpty prepend="AND" property="searchAdptrName">
				B.sqlName LIKE '%' || #searchAdptrName# || '%'
		</isNotEmpty>
		UNION ALL 
		SELECT  A.workGrpCd    ,
			    C.BzwkDsticName,
			    B.adptrCd      ,
			    B.adptrCdSeq   ,
			    B.ftpName      ,
			    B.ftpNameDesc  ,
			    A.adptrKind    ,
			    A.sndRcvKind   ,
		 	    B.intfId
		FROM    $schemaId$.TSEAIEA02 A,
			    $schemaId$.TSEAIEA05 B,
			    $schemaId$.TSEAICM01 C
        WHERE   A.adptrCd = B.adptrCd
        AND     A.workGrpCd = C.EAIBzwkDstcd
        AND     A.workGrpCd =  #searchEaiBzwkDstcd#
		AND     A.sndRcvKind = #searchSndRcvKind#
		AND     A.adptrKind =  #searchAdptrKind#
		<isNotEmpty prepend="AND" property="searchAdptrName">
				B.ftpName LIKE '%' || #searchAdptrName# || '%'
		</isNotEmpty>
		ORDER BY workGrpCd, adptrCd, adptrCdSeq
					) TBL )ORGTABLE 
		WHERE ROWNO BETWEEN #startNum# AND #endNum#
		
	</statement>
	
	<statement id="adapterListCount" resultClass="java.lang.Integer">
		SELECT COUNT(*) FROM (
		SELECT  A.workGrpCd    ,
		 	    C.BzwkDsticName,
		 	    B.adptrCd      ,
		 	    B.adptrCdSeq   ,
		 	    B.sqlName      ,
		 	    B.sqlNameDesc  ,
		 	    A.adptrKind    ,
		 	    A.sndRcvKind   ,
		 	    B.intfId
		FROM    $schemaId$.TSEAIEA02 A,
		 	    $schemaId$.TSEAIEA03 B,
		 	    $schemaId$.TSEAICM01 C
		WHERE   A.adptrCd = B.adptrCd
		AND     A.workGrpCd = C.EAIBzwkDstcd
		AND     A.workGrpCd =  #searchEaiBzwkDstcd#
		AND     A.sndRcvKind = #searchSndRcvKind#
		AND     A.adptrKind =  #searchAdptrKind#
		<isNotEmpty prepend="AND" property="searchAdptrName">
				B.sqlName LIKE '%' || #searchAdptrName# || '%'
		</isNotEmpty>
		UNION ALL 
		SELECT  A.workGrpCd    ,
			    C.BzwkDsticName,
			    B.adptrCd      ,
			    B.adptrCdSeq   ,
			    B.ftpName      ,
			    B.ftpNameDesc  ,
			    A.adptrKind    ,
			    A.sndRcvKind   ,
		 	    B.intfId
		FROM    $schemaId$.TSEAIEA02 A,
			    $schemaId$.TSEAIEA05 B,
			    $schemaId$.TSEAICM01 C
        WHERE   A.adptrCd = B.adptrCd
        AND     A.workGrpCd = C.EAIBzwkDstcd
        AND     A.workGrpCd =  #searchEaiBzwkDstcd#
		AND     A.sndRcvKind = #searchSndRcvKind#
		AND     A.adptrKind =  #searchAdptrKind#
		<isNotEmpty prepend="AND" property="searchAdptrName">
				B.ftpName LIKE '%' || #searchAdptrName# || '%'
		</isNotEmpty>
		ORDER BY workGrpCd, adptrCd, adptrCdSeq
					) TBL
	</statement>
	 
</sqlMap>
